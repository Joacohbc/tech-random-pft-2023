<ui:composition template="/layouts/default.xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="content">
		<f:event type="preRenderView"
			listener="#{emitirConstanciasBean.checkUser}" />

		<h:form id="form">
			<p:dataTable var="c" value="#{emitirConstanciasBean.constancias}"
				id="listaConstancias"
				emptyMessage="No se encontro ninguna constancia con este criterio"
				resizableColumns="true" liveResize="true" showGridlines="true"
				rowKey="#{constancias.idConstancia}" paginator="true" rows="20"
				rowSelectMode="add" paginatorPosition="bottom"
				tableStyle="width:full"
				selection="#{emitirConstanciasBean.constanciasSeleccionadas}">

				<f:facet name="header">
					<p:toolbar>
						<p:toolbarGroup>
							<span style="font-weight: bold">Lista de Constancias</span>
						</p:toolbarGroup>
						<p:toolbarGroup>
							<p:commandButton id="borrar-constancias-button"
								value="#{emitirConstanciasBean.botonBajaMensaje}"
								icon="pi pi-trash"
								actionListener="#{emitirConstanciasBean.bajaUsuarios}"
								styleClass="ui-button-danger"
								disabled="#{emitirConstanciasBean.constanciasSeleccionadas.isEmpty()}"
								update="@this">
							</p:commandButton>

							<p:commandButton id="alta-constancias-button"
								value="#{emitirConstanciasBean.botonAltaMensaje}"
								icon="pi pi-plus"
								actionListener="#{emitirConstanciasBean.altaUsuarios}"
								styleClass="ui-button-success"
								disabled="#{emitirConstanciasBean.constanciasSeleccionadas.isEmpty()}"
								update="@this">
							</p:commandButton>
							
							<div>
								<p:commandButton id="toggler" type="button" value="Columns"
									icon="pi pi-align-justify" />
								<p:columnToggler datasource="listaConstancias" trigger="toggler">
									<p:ajax />
								</p:columnToggler>
							</div>
						</p:toolbarGroup>
					</p:toolbar>
				</f:facet>
				
				<p:ajax event="rowSelect" update=":form:listaConstancias:borrar-constancias-button" />
				<p:ajax event="rowUnselect" update=":form:listaConstancias:borrar-constancias-button" />
				<p:ajax event="rowSelectCheckbox" update=":form:listaConstancias:borrar-constancias-button" />
				<p:ajax event="rowUnselectCheckbox" update=":form:listaConstancias:borrar-constancias-button" />
				<p:ajax event="toggleSelect" update=":form:listaConstancias:borrar-constancias-button" />
				
				<p:ajax event="rowSelect" update=":form:listaConstancias:alta-constancias-button" />
				<p:ajax event="rowUnselect" update=":form:listaConstancias:alta-constancias-button" />
				<p:ajax event="rowSelectCheckbox" update=":form:listaConstancias:alta-constancias-button" />
				<p:ajax event="rowUnselectCheckbox" update=":form:listaConstancias:alta-constancias-button" />
				<p:ajax event="toggleSelect" update=":form:listaConstancias:alta-constancias-button" />
				
				<p:column selectionMode="multiple" style="width:20px;text-align:center"/>

				<p:column headerText="Doc. del Estudiante" sortBy="#{c.estudiante.documento}"
					filterBy="#{c.estudiante.documento}" filterMatchMode="contains">
					<h:outputText value="#{c.estudiante.documento}" />
				</p:column>

				<p:column headerText="Nomb. del Estudiante" sortBy="#{c.estudiante.nombres}"
					filterBy="#{c.estudiante.nombres}" filterMatchMode="contains">
					<h:outputText value="#{c.estudiante.nombres}" />
				</p:column>
				
				<p:column headerText="Apell. del Estudiante" sortBy="#{c.estudiante.apellidos}"
					filterBy="#{c.estudiante.apellidos}" filterMatchMode="contains">
					<h:outputText value="#{c.estudiante.apellidos}" />
				</p:column>
				
				<p:column headerText="Nomb. del Evento" sortBy="#{c.evento.titulo}"
					filterBy="#{c.evento.titulo}" filterMatchMode="contains">
					<h:outputText value="#{c.evento.titulo}" />
				</p:column>
				
				<p:column headerText="Mod. del Evento" sortBy="#{c.evento.modalidad}"
					filterBy="#{c.evento.modalidad}" filterMatchMode="contains">
					<h:outputText value="#{c.evento.modalidad}" />
				</p:column>
				
				<p:column headerText="ITR del Evento" sortBy="#{c.evento.itr.nombre}"
					filterBy="#{c.evento.itr.nombre}" filterMatchMode="contains">
					<h:outputText value="#{c.evento.itr.nombre}" />
				</p:column>

				<p:column headerText="Tipo de Evento" sortBy="#{c.evento.tipoEvento.tipo}"
					filterBy="#{c.evento.tipoEvento.tipo}" filterMatchMode="contains">
					<h:outputText value="#{c.evento.tipoEvento.tipo}" />
				</p:column>

				<p:column headerText="Estado" toggleable="false" sortBy="#{c.estado}"
					filterBy="#{c.estado}" filterMatchMode="contains">
					<h:outputText value="#{c.estado}" />
				</p:column>
														
				<p:column headerText="Acciones" toggleable="false">
			        <p:commandButton value='#{c.estado == "INGRESADO" ? "En Proceso" : "Finalizado"}' action="#{emitirConstanciasBean.cambiarEstado}" icon="pi pi-sync" rendered='#{c.estado != "FINALIZADO"}'>
			            <p:confirm header="Confirmacion" message="Â¿Esta seguro que quiere actualizar esta contancia?" icon="pi pi-exclamation-triangle"/>
			            <f:setPropertyActionListener value="#{c}" target="#{emitirConstanciasBean.constanciaSeleccionada}"></f:setPropertyActionListener>
			        </p:commandButton>
				</p:column>
			</p:dataTable>
		</h:form>
		
        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" responsive="true" width="350">
            <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no ui-button-flat"/>
            <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" />
        </p:confirmDialog>
        
	</ui:define>
</ui:composition>